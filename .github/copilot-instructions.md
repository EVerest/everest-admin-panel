# Project Overview

## Stack

- Vue 3 (Composition API) + TypeScript
- Vite
- Pinia
- Vuetify
- Frontend app that communicates with a backend via RPC-over-WebSocket

## Purpose

Admin UI for EVerest configuration data, module files, and runtime management. Main backend integration lives under `src/modules/evbc`.

# High-level Architecture & Dataflow

- **App bootstrap:** `src/main.ts` installs Vue plugins (`src/plugins/*`) and router (`src/router`).
- **State management:** Pinia stores in `src/store` (see `evbc.ts`). Stores keep `available_configs`, connection state, and UI flags.
- **Backend RPC:** `src/modules/evbc/connection.ts` implements connection + `rpc_issuer`. `client.ts` (`EVBackendClient`) wraps connection lifecycle and publishes connection events consumed by UI components.
- **Config model:** `src/modules/evbc/config_model.ts` (`EVConfigModel`) encapsulates config load/serialize logic and is the canonical model for config manipulation.

# Key Files & Directories

- `src/modules/evbc/` : connection, client, config model, rpc issuers
- `src/modules/evbc/simulator-sample-data/` : simulator sample data and extractor script `update-simulator-data.js`. This extractor script is run on nightly builds to keep the simulator data in sync with the latest interface/module definitions from the main EVerest repository.
- `src/store/` : Pinia stores. `useEvbcStore()` is a frequently-used entry point.
- `src/plugins/i18n.ts` and `src/locales/` : translation setup and message files. The files `en_interfaces_list.ts` and `en_module_info.ts` are generated by the extractor script `update-simulator-data.js`.
- `public/schemas` and `build-tools/fetch-schemas-plugin.ts` : schema artifacts and build integration.
- `cypress/` : E2E tests (fixtures + specs) and `cypress.config.ts`.

# Developer Workflows & Short Commands
- Install deps (repo uses `pnpm`):
```bash
pnpm install
```
- Run dev server:
```bash
pnpm dev
```
- Build / preview:
```bash
pnpm build
pnpm preview
```
- Unit tests (Vitest):
```bash
pnpm test
```
- E2E tests (Cypress):
```bash
pnpm run test:e2e      # headless
pnpm run test:e2e:open # open interactive runner
```
- Linting:
```bash
pnpm lint
pnpm run lint:fix
pnpm vue-tsc
```

# Project-Specific Conventions

- **i18n in events:** Connection events often use computed `i18n` strings, e.g. `computed(() => String(t(...)))` in `client.ts`. When using these messages outside Vue rendering, unwrap them with `unref()`.
- **RPC usage:** Use `this._cxn.rpc_issuer.<method>` for backend calls. These are async and often followed by store updates via `EVBackendClient` methods (e.g. `_reload_configs`).
- **Config lifecycle:** Use `create_config_model(name, config?)` or `load_config(name)` from `EVBackendClient` to create `EVConfigModel` instances. Persist via `save_config()` which calls RPC and reloads configs.
- **Simulator data:** For offline development, `src/modules/evbc/simulator-sample-data/` contains sample configs and interfaces that are safe to use in tests.

# Testing & Debugging Tips

- Run `pnpm dev` and open the browser console to see errors
- To follow connection lifecycle, inspect `src/modules/evbc/client.ts` (event publishing) and `src/modules/evbc/connection.ts` (low-level socket behavior).
- Use the simulator dataset to exercise UI flows without a backend.
- Run Vitest with `-w 1` to simplify debugging output.
